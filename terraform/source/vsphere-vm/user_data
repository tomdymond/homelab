#cloud-config
hostname: ${node_base_name}$${count_index}
fqdn: ${node_base_name}$${count_index}.local.lab
manage_etc_hosts: true
bootcmd:
  - echo ${ansible_vault_password} | base64 --decode > /root/.ansible_vault_password
  - chmod 0600 /root/.ansible_vault_password
runcmd:
  - /usr/bin/ansible-pull --vault-password-file=/root/.ansible_vault_password -C master -d /home/ansible/deploy -i /home/ansible/hosts -U https://github.com/tomdymond/homelab.git ansible/${deploy_stack}.yml | tee -a /tmp/ansible.out
  - [ wget, "http://example.org", -O, /tmp/index.html ]
  - ls -l /root

write_files:
  - path: "/tmp/testfile"
    owner: "root"
    content: |
      HOSTNAME="${node_base_name}"
      VAULT_TOKEN="${vault_token}"
      ANSIBLE_VAULT_PASSWORD="${ansible_vault_password}"
      DEPLOY_STACK="${deploy_stack}"      
